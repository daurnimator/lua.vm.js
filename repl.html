<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>lua.vm.js REPL</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->

    <!-- codemirror -->
    <script src="js/codemirror.js"></script>
    <link rel="stylesheet" href="css/codemirror.css">
    <script src="js/lua.js"></script>

  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="lua.vm.js.html">lua.vm.js</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="lua.vm.js.html">Benchmarks+FAQ</a></li>
              <li class="active"><a href="repl.html">REPL</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <div class="hero-unit">
        <h2>Lua REPL</h2>
      </div>

      <div class="row">
        <div class="span7" border=1>
          <textarea id="mytext">
print('hello' .. ' ' .. 'world!') -- This is Lua!

print(js.run('[0,1,2,3,4,5][3]')) -- Run JS from Lua

-- Interact with the page using Lua

local window = js.get("window")
window.alert("hello from lua!")
window.setTimeout(function() print('hello from lua callback') end, 2500)

local screen = js.get("screen")
print("you haz " .. (screen.width*screen.height) .. " pixels")

local document = js.get("document")
print("this window has title '" .. document.title .. "'")
</textarea>
        </div>
        <div class="span5">
          <h4>output</h4>
          <pre id="output"></pre>
        </div>
      </div>

      <p><a href="#" class="btn btn-primary btn-large " onclick="executeLua(myCodeMirror.getValue(), true); return false" id="the_button">Execute &raquo;</a></p>

      <div class="row-fluid">
        <div class="span">
          <h3>Status</h3>
          <p>The stuff you see in the example above works, which includes using JavaScript objects from
             Lua as if they were Lua objects, calling the DOM, callbacks into Lua, etc. And as mentioned on
             the <a href="lua.vm.js.html">main page</a>, this uses the compiled Lua VM, so it includes all
             the normal Lua languages features, and it's compiled into asm.js so it can have reasonable performance.</p>
          <h3>Limitations</h3>
          <p>Not all ways to interact between JavaScript and Lua have been implemented yet, this is a work in progress. If you see something missing please
             file an issue.</p>
          <p>No effort has been made to optimize the JavaScript/Lua glue layer whatsoever.</p>
          <p>The glue layer holds strong references to everything currently. We could use Lua userdata with <code>__gc</code> to fix that.</p>
        </div>
      </div>

    </div> <!-- /container -->

<script>
// CodeMirror
var myCodeMirror = CodeMirror.fromTextArea(document.getElementById('mytext'));
//myCodeMirror.setSize(screen.width*0.6, screen.height*0.2);

// Execution
var outputElement = document.getElementById('output')
var Module = {
  print: function(x) {
    outputElement.innerHTML = (outputElement.innerHTML ? outputElement.innerHTML + '<br>' : '') + x;
  }
};

function executeLua(code, clear) {
  if (clear) outputElement.innerHTML = '';
  ccall('lua_execute', null, ['string'], [code]);
}
</script>

<script src="lua/src/emlua_shell.js"></script>

<script>
// load js.lua glue
var xhr = new XMLHttpRequest();
xhr.open('get', 'js.lua', false);
xhr.overrideMimeType('text/plain');
xhr.send(null);
var jsLua = xhr.response;
executeLua(jsLua);
</script>

    <a href="https://github.com/kripken/lua.vm.js"><img style="position: absolute; top: 35px; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

  </body>
</html>

